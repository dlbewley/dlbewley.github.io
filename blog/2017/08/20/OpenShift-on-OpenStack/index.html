<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta name=viewport content="width=device-width,initial-scale=1"><title>Installing OpenShift on OpenStack | GUI Free Life</title><meta name=author content="Dale Bewley"><meta name=keywords content="bewley,guifreelife,kubernetes,openshift,openstack,draft"><meta name=description content="GUI Free Life, by Dale Bewley covers Kubernetes, Linux, Networking, OpenShift and more"><meta name=generator content="Hugo 0.119.0"><link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel=stylesheet type=text/css><link rel=stylesheet href=//use.fontawesome.com/releases/v5.11.2/css/all.css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link href=/css/animate.css rel=stylesheet><link href=/css/style.turquoise.css rel=stylesheet id=theme-stylesheet><link href=/css/custom.css rel=stylesheet><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel="shortcut icon" href=/img/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link href=/css/owl.carousel.css rel=stylesheet><link href=/css/owl.theme.css rel=stylesheet><link rel=alternate href=http://guifreelife.com/index.xml type=application/rss+xml title="GUI Free Life"><meta property="og:locale" content="en_us"><meta property="og:site_name" content="GUI Free Life"><meta property="og:title" content="Installing OpenShift on OpenStack"><meta property="og:type" content="article"><meta property="og:url" content="http://guifreelife.com/blog/2017/08/20/OpenShift-on-OpenStack/"><meta property="og:description" content="GUI Free Life, by Dale Bewley covers Kubernetes, Linux, Networking, OpenShift and more"><meta property="og:image" content="http://guifreelife.com/images/thumb/openshift-ha-cluster-routing.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="525"><meta property="og:image:height" content="384"><meta property="og:updated_time" content="2017-08-20T00:00:00Z"><meta property="article:tag" content="kubernetes"><meta property="article:tag" content="openshift"><meta property="article:tag" content="openstack"><meta property="article:tag" content="draft"><meta property="article:published_time" content="2017-08-20T00:00:00Z"><meta property="article:modified_time" content="2017-08-20T00:00:00Z"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@dlbewley"><meta name=twitter:title content="Installing OpenShift on OpenStack"><meta name=twitter:image content="http://guifreelife.com/images/thumb/openshift-ha-cluster-routing.png"><meta name=twitter:description content="GUI Free Life, by Dale Bewley covers Kubernetes, Linux, Networking, OpenShift and more"></head><body><div id=all><header class=navbar-affixed-top data-spy=affix data-offset-top=62><div class="navbar navbar-default yamm" role=navigation id=navbar><div class=container><div class=navbar-header><a class="navbar-brand home" href=/><img src=/img/logo.png alt="Installing OpenShift on OpenStack logo" class="hidden-xs hidden-sm">
<img src=/img/logo-small.png alt="Installing OpenShift on OpenStack logo" class="visible-xs visible-sm">
<span class=sr-only>Installing OpenShift on OpenStack - go to homepage</span></a><div class=navbar-buttons><button type=button class="navbar-toggle btn-template-main" data-toggle=collapse data-target=#navigation>
<span class=sr-only>Toggle Navigation</span>
<i class="fas fa-align-justify"></i></button></div></div><div class="navbar-collapse collapse" id=navigation><ul class="nav navbar-nav navbar-right"><li class=dropdown><a href=/>Home</a></li><li class="dropdown active"><a href=/blog/>Blog</a></li><li class=dropdown><a href=/contact/>Contact</a></li></ul></div><div class="collapse clearfix" id=search><form class=navbar-form role=search><div class=input-group><input type=text class=form-control placeholder=Search>
<span class=input-group-btn><button type=submit class="btn btn-template-main"><i class="fas fa-search"></i></button></span></div></form></div></div></div></header><style>.bar.background-image-fixed-banner{background:url(/images/thumb/openshift-ha-cluster-routing.png)50% 0 no-repeat;background-attachment:fixed;background-size:cover;padding:100px 5%;text-shadow:2px 3px 4px var(--primary-accent),0 0 1em var(--navbar-border-top)}</style><div><div class=container><div class=row><div class=col-md-12><section class="bar background-image-fixed-banner heading h2 color-white text-center"><h1>Installing OpenShift on OpenStack</h1></section></div></div></div></div><div id=content><div class=container><div class=row><div class=col-md-9 id=blog-post><p class="text-muted text-uppercase mb-small text-right">August 20, 2017</p><div id=post-content><p><strong>This is a work in progress</strong></p><p>The OpenShift Container Platform (OCP) can run on many types of infrastructure; from a Docker contrainer, to a single VM, to a fleet of baremetal or VMs on an infrastructure provider such as RHV, VMware, Amazon EC2, Google Compute Engine, or OpenStack Platform (OSP). This post is to document my experimentation with setting up OCP on OSP.</p><h1 id=doc-overview>Doc Overview</h1><p>So where are the docs?</p><p>The Reference Architecture <a href=https://access.redhat.com/articles/3133011>2017 - Deploying Red Hat OpenShift Container Platform 3.4 on Red Hat OpenStack Platform 10</a> derives from the Redhat <a href=https://github.com/redhat-openstack/openshift-on-openstack>OpenShift on OpenStack Github repo</a> provides the orchestration templates to stand up a infrastructure stack to run OpenShift on. At the moment the last releases are OCP 3.6 and OSP 11. Let&rsquo;s target that even if it &ldquo;isn&rsquo;t supported&rdquo;.</p><p>Antonio Gallego has created a script to <a href=https://github.com/antoniogallegosaez/openshift_on_openstack_preparer>prepare OpenStack for OpenShift</a>. Does this overlap with the openshift-on-openstack repo though? The openshift-ansible repo includes a <a href=https://github.com/openshift/openshift-ansible/blob/master/inventory/openstack/hosts/openstack.py>openstack dynamic inventory</a> module, but it is not yet clear to me how best to utilize it. For my production cluster, I tend to keep my intentory synchronized to <a href=https://github.com/openshift/openshift-ansible/blob/master/inventory/byo/hosts.ose.example>hosts.ose.example</a>.</p><p>The openshift-ansible-contrib project has a <a href=https://github.com/openshift/openshift-ansible-contrib/tree/master/roles/openstack-stack>openstack-stack</a> role for deploying OpenShift to OpenStack, I&rsquo;m not sure of the state, but there is a <a href=https://github.com/openshift/openshift-ansible-contrib/tree/master/reference-architecture/osp-dns>reference-architecture/osp-dns</a> to deploy a DNS infra suitable for testing.</p><p>While heat and the ansible playbook will do this for you, it is interesting to look at the <a href=https://github.com/openshift/openshift-ansible-contrib/tree/master/reference-architecture/osp-cli>CLI commands</a> to configure OpenStack for OpenShift. This scripts are sprinkled through the ref arch document as well.</p><p>OpenShift its self needs to be <a href=https://docs.openshift.com/container-platform/latest/install_config/configuring_openstack.html>configured for OpenStack</a> to make use of storage and other services provided by OpenStack. The <a href=https://github.com/openshift/openshift-ansible>OpenShift Ansible playbook</a> is used to install and configure OpenShift on any platform including OpenStack and the settings will be placed in the playbook host inventory file.</p><h1 id=networking-overview>Networking Overview</h1><p>OpenShift highly available routing is somewhat complex on its own.</p><p><a href=http://guifreelife.com/blog/2016/03/01/OpenShift-3-HA-Routing><img src=/images/thumb/openshift-ha-cluster-routing.png alt="OpenShift HA Routing"></a></p><p>Toss in the even more complex OpenStack networking, and well, hopefully you are not starting from scratch.</p><p><a href=http://guifreelife.com/blog/2017/08/14/OpenStack-Network-Diagram><img src=/images/thumb/openstack-network-pub.png alt="OpenStack Network Diagram"></a></p><p>The reference architecture forgoes the <a href=https://docs.openshift.com/container-platform/latest/architecture/additional_concepts/sdn.html>OpenShift SDN with ovs-subnet plugin</a> and <a href=https://docs.openshift.com/container-platform/latest/architecture/additional_concepts/flannel.html>uses Flannel</a>. Notes on <a href=https://docs.openshift.com/container-platform/latest/install_config/configuring_sdn.html#using-flannel>configuring Flannel networking</a>.</p><p><a href=https://github.com/redhat-openstack/openshift-on-openstack/blob/master/graphics/architecture.png><img src=https://raw.githubusercontent.com/redhat-openstack/openshift-on-openstack/master/graphics/architecture.png alt="Openshift on OpenStack Reference Arch Diagram"></a></p><p>There are some drawbacks to using Flannel when it comes to isolation. An interesting alternative to Flannel could be <a href=https://www.projectcalico.org/>Project Calico</a> which uses BGP routing amongst containers while also supporting microsegmentation of traffic. <a href=https://www.tigera.io>Tigera.io</a> develops and supports Calico commercially.</p><h2 id=networking-details>Networking Details</h2><p>There will be 3 OpenStack networks in use:</p><ul><li>A <em>public</em> network for external access to the OpenStack / OpenShift services eg: <code>N5: External</code> or <code>N8: Provider</code>
To do a HA setup, I think I need a</li><li>A <em>control</em> network for OpenShift node communication eg:</li><li>A <em>tenant</em> network for container communicatios</li></ul><h2 id=instance-details>Instance Details</h2><table><thead><tr><th>Host</th><th>IP</th><th>Description</th></tr></thead><tbody><tr><td>openshift.ocp3.example.com</td><td>10.19.x.y (Load Balancer)</td><td>Web console and API endpoint</td></tr><tr><td>*.ocp3.example.com</td><td>10.19.x.y (Router)</td><td>OpenShift routes to services handled by haproxy.</td></tr><tr><td>bastion</td><td></td><td>Operator access and Ansible management point</td></tr><tr><td>master-01</td><td></td><td>One of three redundant OpenShift Masters</td></tr><tr><td>master-02</td><td></td><td>One of three redundant OpenShift Masters</td></tr><tr><td>master-03</td><td></td><td>One of three redundant OpenShift Masters</td></tr><tr><td>node-01</td><td></td><td>One of two redundant Infrastructure nodes</td></tr><tr><td>node-02</td><td></td><td>One of two redundant Infrastructure nodes</td></tr><tr><td>node-03</td><td></td><td>One of two redundant Application nodes</td></tr><tr><td>node-04</td><td></td><td>One of two redundant Application nodes</td></tr><tr><td>etcd?</td><td></td><td>Etcd is not called out in the ref arch. Does it assume all-in-one master?</td></tr></tbody></table><ul><li>Public network for external admin access</li><li>Control network</li></ul><h1 id=infrastructure-setup>Infrastructure Setup</h1><p>The following steps will need to take place whether by hand, or with the benefit of the <a href=https://www.openstack.org/software/releases/ocata/components/heat>OpenStack Heat</a> templates from the <a href=https://github.com/redhat-openstack/openshift-on-openstack>OpenShift on OpenStack repo</a>.</p><ul><li><input checked disabled type=checkbox> From the OpenStack Director host, RHEL image in glance from <code>rhel-guest-image-7</code> rpm. (Convert to RAW is using Ceph RBD CoW)</li></ul><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo yum -y install rhel-guest-image-7 <span style=color:#228b22># or download newer from https://access.redhat.com</span>
</span></span><span style=display:flex><span>$ cp -p /usr/share/rhel-guest-image-7/rhel-guest-image-7*.qcow2 /tmp/
</span></span><span style=display:flex><span>$ virt-customize <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    -a /tmp/rhel-guest-image-7*.qcow2 <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    --root-password password:&lt;default_root_password&gt;
</span></span><span style=display:flex><span>$ qemu-img convert <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    -f qcow2 <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    -O raw <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    /tmp/rhel-guest-image-7*.qcow2 <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    /tmp/rhel7.raw
</span></span><span style=display:flex><span>$ openstack image create <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    rhel7 <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    --container-format bare <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    --disk-format raw <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    --file /tmp/rhel7.raw <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    --public
</span></span></code></pre></div><ul><li><p>deploy 8 virtual machines on network</p></li><li><p>provision DNS dynamic domain See <a href=https://access.redhat.com/documentation/en-us/reference_architectures/2017/html-single/deploying_red_hat_openshift_container_platform_3.4_on_red_hat_openstack_platform_10/#appendix-b>appendix B</a> and <a href=https://github.com/openshift/openshift-ansible-contrib/blob/master/roles/dns-records/tasks/main.yml>openshift-ansible-contrib/roles/dns-records</a></p></li><li><p>configure <a href=https://github.com/openshift/openshift-ansible>OpenShift Ansible</a> inventory file</p></li><li><p>deploy OpenShift</p></li></ul><h2 id=openstack-prerequisites>OpenStack Prerequisites</h2><p>Many of these steps are included in <a href=https://github.com/openshift/openshift-ansible-contrib/tree/master/reference-architecture/osp-cli>openshift-ansible-contrib/reference-architecture/osp-cli</a></p><ul><li><input checked disabled type=checkbox> Increase keystone token expiration to 7200s to ensure OpenShift Ansible can complete. See <a href=https://access.redhat.com/documentation/en-us/reference_architectures/2017/html-single/deploying_red_hat_openshift_container_platform_3.4_on_red_hat_openstack_platform_10/#appendix-c>appendix</a> and <a href=https://access.redhat.com/solutions/1527533>solution 1527533</a></li></ul><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#228b22>#  ansible playbook to extend keystone token expiration</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>hosts</span>:<span style=color:#bbb> </span>controller<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>become</span>:<span style=color:#bbb> </span><span style=color:#8b008b;font-weight:700>true</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>become_user</span>:<span style=color:#bbb> </span>root<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>tasks</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>who am i<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>debug</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>msg</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;{{ansible_fqdn}}&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>configure keystone token expiration<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>lineinfile</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>dest</span>:<span style=color:#bbb> </span>/etc/keystone/keystone.conf<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>regexp</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#39;^expiration = .*&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>line</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#39;expiration = 7200&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>backup</span>:<span style=color:#bbb> </span><span style=color:#8b008b;font-weight:700>yes</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>notify</span>:<span style=color:#bbb> </span>restart keystone<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>handlers</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>restart keystone<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>service</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>httpd<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>state</span>:<span style=color:#bbb> </span>restarted<span style=color:#bbb>
</span></span></span></code></pre></div><ul><li><input checked disabled type=checkbox> OpenStack tenant to run in: eg. <code>ocp3</code></li></ul><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ openstack project create ocp3 --enable
</span></span><span style=display:flex><span>$ openstack user create ocp3 --email dlbewley@example.com --project ocp3 --enable --password &lt;password&gt;
</span></span><span style=display:flex><span><span style=color:#228b22># create ocp3rc with credentials</span>
</span></span></code></pre></div><ul><li><input checked disabled type=checkbox> <a href=https://docs.openstack.org/python-openstackclient/latest/cli/command-objects/quota.html>Increase Quota</a> to meet <a href=https://access.redhat.com/documentation/en-us/reference_architectures/2017/html/deploying_red_hat_openshift_container_platform_3.4_on_red_hat_openstack_platform_10/deploying_using_heat#project_quotas>recommendations</a></li></ul><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ openstack quota show ocp3
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>$ openstack quota <span style=color:#658b00>set</span> ocp3 <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>              --cores <span style=color:#b452cd>60</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>              --gigabytes <span style=color:#b452cd>2000</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>              --instances <span style=color:#b452cd>20</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>              --ram <span style=color:#8b008b;font-weight:700>$((</span> <span style=color:#b452cd>450</span> * <span style=color:#b452cd>1024</span> <span style=color:#8b008b;font-weight:700>))</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>              --volumes <span style=color:#b452cd>30</span>
</span></span></code></pre></div><ul><li><input checked disabled type=checkbox> An SSH keypair pre-loaded in nova</li></ul><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#228b22># save the private key for later</span>
</span></span><span style=display:flex><span>$ openstack keypair create ocp3 &gt; ~/.ssh/ocp3.key
</span></span><span style=display:flex><span>$ openstack keypair show ocp3 --public-key &gt; ~/.ssh/ocp3.pub
</span></span></code></pre></div><ul><li><p><input disabled type=checkbox> Openstack user account in tenant: eg.<code>ocp_ops</code></p></li><li><p>Grant <code>member</code> role to install OpenShift manually</p></li><li><p>Grant <code>heat_stack_owner</code> role to install using Heat</p></li><li><p>A Red Hat Enterprise Linux update subscription credentials (user/password or Satellite server)</p></li><li><p>A publicly available neutron network for inbound access to router (infra nodes), masters, bastion,
A pool of floating IP addresses to provide inbound access points for instances
A host running haproxy to provide load-balancing
A host running bind with a properly delegated sub-domain for publishing, and a key for dynamic updates.
An existing LDAP or Active Directory service for user identification and authentication</p></li></ul><h2 id=deploy-a-dyanmic-dns-server>Deploy a Dyanmic DNS Server</h2><p>During testing <a href=https://access.redhat.com/documentation/en-us/reference_architectures/2017/html/deploying_red_hat_openshift_container_platform_3.4_on_red_hat_openstack_platform_10/appendix-b>create a DNS server</a> in the project which we can be updated using <code>nsupdate</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/openshift/openshift-ansible-contrib
</span></span></code></pre></div><ul><li><input disabled type=checkbox> Create a <code>dns-vars.yaml</code> for feeding to <a href=https://github.com/openshift/openshift-ansible-contrib/blob/master/reference-architecture/osp-dns/deploy-dns.yaml>deploy-dns.yaml</a> playbook</li></ul><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#008b45;text-decoration:underline>---</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>domain_name</span>:<span style=color:#bbb> </span>ocp3.example.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>contact</span>:<span style=color:#bbb> </span>admin@ocp3.example.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#228b22># real DNS servers from environment</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>dns_forwarders</span>:<span style=color:#bbb> </span>[<span style=color:#b452cd>10.</span>x.x.41, 10.x.x.2]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>update_key</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;NOT A REAL KEY&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>slave_count</span>:<span style=color:#bbb> </span><span style=color:#b452cd>2</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>stack_name</span>:<span style=color:#bbb> </span>dns-service<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>external_network</span>:<span style=color:#bbb> </span>public<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>image</span>:<span style=color:#bbb> </span>rhel7<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>flavor</span>:<span style=color:#bbb> </span>m1.small<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>ssh_user</span>:<span style=color:#bbb> </span>cloud-user<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>ssh_key_name</span>:<span style=color:#bbb> </span>ocp3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#228b22># NOTE: For Red Hat Enterprise Linux:</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#228b22># rhn_username: &#34;rhnusername&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#228b22># rhn_password: &#34;NOT A REAL PASSWORD&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#228b22># rhn_pool: &#34;pool id string&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#228b22># Either RHN or Sat6</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>sat6_hostname</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>sat6_organization</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>sat6_activationkey</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><ul><li><input disabled type=checkbox> Run <code>deploy-dns.sh</code> like this</li></ul><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#1e889b>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#1e889b></span><span style=color:#658b00>export</span> <span style=color:#00688b>ANSIBLE_HOST_KEY_CHECKING</span>=False
</span></span><span style=display:flex><span>ansible-playbook --private-key ocp3.key -e @dns-vars.yaml -vv<span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>        openshift-ansible-contrib/reference-architecture/osp-dns/deploy-dns.yaml | tee dns-deploy.log
</span></span></code></pre></div><p>My network deployed, but I hit an error caused by the <a href=https://docs.openstack.org/nova/latest/user/filter-scheduler.html>Nova scheduler</a> configuration while deploying the instances, so I <a href=https://github.com/openshift/openshift-ansible-contrib/issues/699>opened an issue</a></p><pre tabindex=0><code>17-08-27 02:21:14Z [dns-service.hosts]: CREATE_FAILED  ResourceInError: resources.hosts.resources.slaves.resources.slaves.resources[1].resources.host: Went to status ERROR due to \&#34;Message: ServerGroup policy is not supported: ServerGroupAntiAffinityFilter not configured, Code: 400\&#34;&#34;, &#34;2017-08-27 02:21:14Z [dns-service]: CREATE_FAILED  Resource CREATE failed: ResourceInError: resources.hosts.resources.slaves.resources.slaves.resources[1].resources.host: Went to status ERROR due to \&#34;Message: ServerGroup policy is not supported: ServerGroupAntiAffinityFilter not configured, Code: 400\&#34;&#34;]}
</code></pre><pre tabindex=0><code>[stack@director ~]$ openstack server group list
+--------------------------------------+--------------------+---------------+
| ID                                   | Name               | Policies      |
+--------------------------------------+--------------------+---------------+
| 0eb9c161-3abd-44a6-80c7-0dea63f2060e | slave_server_group | anti-affinity |
+--------------------------------------+--------------------+---------------+
</code></pre><h1 id=heat-deployment>Heat Deployment</h1><p><a href=https://access.redhat.com/documentation/en-us/reference_architectures/2017/html-single/deploying_red_hat_openshift_container_platform_3.4_on_red_hat_openstack_platform_10/#deploying_using_heat>Deploy OpenShift on OpenStack using Heat</a></p><ul><li>Make the heat templates available. If the <code>openshift-heat-templates</code> RPM is not reachable, clone the repo and</li></ul><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo yum -y install python-heatclient openshift-heat-templates <span style=color:#228b22># missing in OSP 11</span>
</span></span><span style=display:flex><span><span style=color:#228b22># or</span>
</span></span><span style=display:flex><span><span style=color:#658b00>cd</span> ~stack/templates
</span></span><span style=display:flex><span>git clone https://github.com/redhat-openstack/openshift-on-openstack
</span></span></code></pre></div><ul><li>Get or create a <code>openshift_parameters.yaml</code> heat template. Use <a href=https://github.com/redhat-openstack/openshift-on-openstack/blob/master/openshift.yaml>this one</a> or copy from example in README.adoc or copy <a href=https://access.redhat.com/documentation/en-us/reference_architectures/2017/html/deploying_red_hat_openshift_container_platform_3.4_on_red_hat_openstack_platform_10/deploying_using_heat#heat_stack_configuration>from the ref arch</a></li></ul></div><div id=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//dlbewleygithubio.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class=col-md-3><div class="panel panel-default sidebar-menu"><div class=panel-heading><h3 class=panel-title>Search</h3></div><div class=panel-body><form action=//google.com/search method=get accept-charset=utf-8 role=search><div class=input-group><input type=search name=q class=form-control placeholder=Search>
<input type=hidden name=sitesearch value=http://guifreelife.com/>
<span class=input-group-btn><button type=submit class="btn btn-template-main"><i class="fas fa-search"></i></button></span></div></form></div></div><div class="panel sidebar-menu"><div class=panel-heading><h3 class=panel-title>Tagged</h3></div><div class=panel-body><ul class=tag-cloud><li class=active><a href=/tags/kubernetes><i class="fas fa-tags"></i> kubernetes</a></li><li class=active><a href=/tags/openshift><i class="fas fa-tags"></i> openshift</a></li><li class=active><a href=/tags/openstack><i class="fas fa-tags"></i> openstack</a></li><li class=active><a href=/tags/draft><i class="fas fa-tags"></i> draft</a></li></ul></div></div><div class="panel sidebar-menu"><div class=panel-heading><h3 class=panel-title>TOC</h3></div><div class=panel-body><nav id=TableOfContents><ul><li><a href=#doc-overview>Doc Overview</a></li><li><a href=#networking-overview>Networking Overview</a><ul><li><a href=#networking-details>Networking Details</a></li><li><a href=#instance-details>Instance Details</a></li></ul></li><li><a href=#infrastructure-setup>Infrastructure Setup</a><ul><li><a href=#openstack-prerequisites>OpenStack Prerequisites</a></li><li><a href=#deploy-a-dyanmic-dns-server>Deploy a Dyanmic DNS Server</a></li></ul></li><li><a href=#heat-deployment>Heat Deployment</a></li></ul></nav></div></div><div class="panel sidebar-menu"><div class=panel-heading><h3 class=panel-title>Tags</h3></div><div class=panel-body><ul class=tag-cloud><li><a href=/tags/AWS><i class="fas fa-tags"></i> AWS</a></li><li><a href=/tags/CDK><i class="fas fa-tags"></i> CDK</a></li><li><a href=/tags/OCP3><i class="fas fa-tags"></i> OCP3</a></li><li><a href=/tags/OCP4><i class="fas fa-tags"></i> OCP4</a></li><li><a href=/tags/RHACM><i class="fas fa-tags"></i> RHACM</a></li><li><a href=/tags/RHACS><i class="fas fa-tags"></i> RHACS</a></li><li><a href=/tags/RHEL><i class="fas fa-tags"></i> RHEL</a></li><li><a href=/tags/ansible><i class="fas fa-tags"></i> ansible</a></li><li><a href=/tags/automation><i class="fas fa-tags"></i> automation</a></li><li><a href=/tags/azure><i class="fas fa-tags"></i> azure</a></li><li><a href=/tags/debugging><i class="fas fa-tags"></i> debugging</a></li><li><a href=/tags/docker><i class="fas fa-tags"></i> docker</a></li><li><a href=/tags/draft><i class="fas fa-tags"></i> draft</a></li><li><a href=/tags/etcd><i class="fas fa-tags"></i> etcd</a></li><li><a href=/tags/git><i class="fas fa-tags"></i> git</a></li><li><a href=/tags/haproxy><i class="fas fa-tags"></i> haproxy</a></li><li><a href=/tags/heat><i class="fas fa-tags"></i> heat</a></li><li><a href=/tags/hybrid-cloud><i class="fas fa-tags"></i> hybrid-cloud</a></li><li><a href=/tags/install><i class="fas fa-tags"></i> install</a></li><li><a href=/tags/kubernetes><i class="fas fa-tags"></i> kubernetes</a></li><li><a href=/tags/mac><i class="fas fa-tags"></i> mac</a></li><li><a href=/tags/metrics><i class="fas fa-tags"></i> metrics</a></li><li><a href=/tags/migration><i class="fas fa-tags"></i> migration</a></li><li><a href=/tags/monitoring><i class="fas fa-tags"></i> monitoring</a></li><li><a href=/tags/networking><i class="fas fa-tags"></i> networking</a></li><li><a href=/tags/openshift><i class="fas fa-tags"></i> openshift</a></li><li><a href=/tags/openstack><i class="fas fa-tags"></i> openstack</a></li><li><a href=/tags/operators><i class="fas fa-tags"></i> operators</a></li><li><a href=/tags/prometheus><i class="fas fa-tags"></i> prometheus</a></li><li><a href=/tags/python><i class="fas fa-tags"></i> python</a></li><li><a href=/tags/router><i class="fas fa-tags"></i> router</a></li><li><a href=/tags/security><i class="fas fa-tags"></i> security</a></li><li><a href=/tags/ssl><i class="fas fa-tags"></i> ssl</a></li><li><a href=/tags/stackrox><i class="fas fa-tags"></i> stackrox</a></li><li><a href=/tags/storage><i class="fas fa-tags"></i> storage</a></li><li><a href=/tags/troubleshooting><i class="fas fa-tags"></i> troubleshooting</a></li><li><a href=/tags/upgrade><i class="fas fa-tags"></i> upgrade</a></li><li><a href=/tags/vagrant><i class="fas fa-tags"></i> vagrant</a></li><li><a href=/tags/virtualization><i class="fas fa-tags"></i> virtualization</a></li><li><a href=/tags/webinar><i class="fas fa-tags"></i> webinar</a></li><li><a href=/tags/windows><i class="fas fa-tags"></i> windows</a></li><li><a href=/tags/zabbix><i class="fas fa-tags"></i> zabbix</a></li><li><a href=/tags/zimbra><i class="fas fa-tags"></i> zimbra</a></li></ul></div></div></div></div></div></div><footer id=footer><div class=container><div class="col-md-4 col-sm-6"><h4>Share</h4><i class="fab fa-2x fa-twitter" title="Share this on Twitter" onclick='window.open("http://twitter.com/home?status=http://guifreelife.com/blog/2017/08/20/OpenShift-on-OpenStack/")'></i>
<i class="fab fa-2x fa-facebook" title="Share this on Facebook" onclick='window.open("http://www.facebook.com/share.php?u=http://guifreelife.com/blog/2017/08/20/OpenShift-on-OpenStack/")'></i>
<i class="fab fa-2x fa-linkedin" title="Share this on Linkedin" onclick='window.open("https://www.linkedin.com/shareArticle?mini=true&url=http://guifreelife.com/blog/2017/08/20/OpenShift-on-OpenStack/&title=&summary=&source=")'></i>
<i class="fab fa-2x fa-google-plus" title="Share this on Google Currents" onclick='window.open("https://plus.google.com/share?url=http://guifreelife.com/blog/2017/08/20/OpenShift-on-OpenStack/")'></i>
<i class="fa fa-2x fa-envelope" title="Share this through Email" onclick='window.open("mailto:?&body=http://guifreelife.com/blog/2017/08/20/OpenShift-on-OpenStack/")'></i><h4>About us</h4><p>GUI Free Life is the personal, technical blog of Dale Bewley. Comments and opinions are my own and not that of my employers.</p><hr class="hidden-md hidden-lg hidden-sm"></div><div class="col-md-4 col-sm-6"><h4>Recent posts</h4><div class=blog-entries><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=http://guifreelife.com/blog/2024/03/11/Placing-Open-Cluster-Management-Policies-on-Kubernetes/><img src=/images/DALL%c2%b7E%202024-01-30%2014.28.24%20-%20A%20whimsical%20scene%20featuring%20a%20traffic%20cop%20standing%20on%20a%20cloud,%20energetically%20directing%20a%20chaotic%20stream%20of%20various%20floating%20documents%20-%20papers,%20folder.png class=img-responsive alt="Using Placements to Apply Open Cluster Management Policies to Kubernetes Clusters"></a></div><div class="name same-height-always"><h5><a href=http://guifreelife.com/blog/2024/03/11/Placing-Open-Cluster-Management-Policies-on-Kubernetes/>Using Placements to Apply Open Cluster Management Policies to Kubernetes Clusters</a></h5></div></div><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=http://guifreelife.com/blog/2023/09/22/Storing-OpenShift-Credentials-with-1Password/><img src=/img/banners/mushroom-moss.jpg class=img-responsive alt="Storing OpenShift Credentials with 1Password"></a></div><div class="name same-height-always"><h5><a href=http://guifreelife.com/blog/2023/09/22/Storing-OpenShift-Credentials-with-1Password/>Storing OpenShift Credentials with 1Password</a></h5></div></div><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=http://guifreelife.com/blog/2023/04/06/Accessing-Ceph-CLI-with-OpenShift-Data-Foundation/><img src=/images/uncovered-bumper.png class=img-responsive alt="Accessing the Ceph CLI with OpenShift Data Foundation"></a></div><div class="name same-height-always"><h5><a href=http://guifreelife.com/blog/2023/04/06/Accessing-Ceph-CLI-with-OpenShift-Data-Foundation/>Accessing the Ceph CLI with OpenShift Data Foundation</a></h5></div></div></div><hr class="hidden-md hidden-lg"></div><div class="col-md-4 col-sm-6"><h4>Contact</h4><p class=text-uppercase><strong>Dale Bewley</strong><br>Oakland<br>California<br><strong>USA</strong></p><a href=/contact class="btn btn-small btn-template-main">Go to contact page</a><hr class="hidden-md hidden-lg hidden-sm"></div></div></footer><div id=copyright><div class=container><div class=col-md-12><p class=pull-left>Copyright (c) 2021, Dale Bewley; all rights reserved.</p><p class=pull-right>Template by <a href=https://bootstrapious.com/p/universal-business-e-commerce-template>Bootstrapious</a>.
Ported to Hugo by <a href=https://github.com/devcows/hugo-universal-theme>DevCows</a>.</p></div></div></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-39TSW9349X"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-39TSW9349X",{anonymize_ip:!1})}</script><script src=//code.jquery.com/jquery-3.1.1.min.js integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin=anonymous></script>
<script src=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js></script>
<script src="//maps.googleapis.com/maps/api/js?key=AIzaSyDacpwSIXi6lk2fS2wzZOSoh7iHm_ZP3UE&v=3.exp"></script>
<script src=/js/hpneo.gmaps.js></script>
<script src=/js/gmaps.init.js></script>
<script src=/js/front.js></script>
<script src=/js/owl.carousel.min.js></script></body></html>