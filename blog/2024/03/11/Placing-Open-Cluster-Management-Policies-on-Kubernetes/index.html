<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta name=viewport content="width=device-width,initial-scale=1"><title>Using Placements to Apply Open Cluster Management Policies to Kubernetes Clusters | GUI Free Life</title><meta name=author content="Dale Bewley"><meta name=keywords content="bewley,guifreelife,RHACM,openshift,kubernetes"><meta name=description content="Red Hat Advanced Cluster Management enables Open Cluster Management policy driven governance of an entire fleet of Kubernetes clusters. Associating policies with the appropriate clusters is a very flexible operation and requires understanding resources like Placements and ManagedClusterSetBindings. So let&amp;rsquo;s get familiar!"><meta name=generator content="Hugo 0.119.0"><link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel=stylesheet type=text/css><link rel=stylesheet href=//use.fontawesome.com/releases/v5.11.2/css/all.css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link href=/css/animate.css rel=stylesheet><link href=/css/style.turquoise.css rel=stylesheet id=theme-stylesheet><link href=/css/custom.css rel=stylesheet><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel="shortcut icon" href=/img/favicon.ico type=image/x-icon><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link href=/css/owl.carousel.css rel=stylesheet><link href=/css/owl.theme.css rel=stylesheet><link rel=alternate href=http://guifreelife.com/index.xml type=application/rss+xml title="GUI Free Life"><meta property="og:locale" content="en_us"><meta property="og:site_name" content="GUI Free Life"><meta property="og:title" content="Using Placements to Apply Open Cluster Management Policies to Kubernetes Clusters"><meta property="og:type" content="article"><meta property="og:url" content="http://guifreelife.com/blog/2024/03/11/Placing-Open-Cluster-Management-Policies-on-Kubernetes/"><meta property="og:description" content="Red Hat Advanced Cluster Management enables Open Cluster Management policy driven governance of an entire fleet of Kubernetes clusters. Associating policies with the appropriate clusters is a very flexible operation and requires understanding resources like Placements and ManagedClusterSetBindings. So let&amp;rsquo;s get familiar!"><meta property="og:image" content="http://guifreelife.com/images/DALL%C2%B7E%202024-01-30%2014.28.24%20-%20A%20whimsical%20scene%20featuring%20a%20traffic%20cop%20standing%20on%20a%20cloud,%20energetically%20directing%20a%20chaotic%20stream%20of%20various%20floating%20documents%20-%20papers,%20folder.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1792"><meta property="og:image:height" content="1024"><meta property="og:updated_time" content="2024-03-11T00:00:00Z"><meta property="article:tag" content="RHACM"><meta property="article:tag" content="openshift"><meta property="article:tag" content="kubernetes"><meta property="article:published_time" content="2024-03-11T00:00:00Z"><meta property="article:modified_time" content="2024-03-11T00:00:00Z"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@dlbewley"><meta name=twitter:title content="Using Placements to Apply Open Cluster Management Policies to …"><meta name=twitter:image content="http://guifreelife.com/images/DALL%C2%B7E%202024-01-30%2014.28.24%20-%20A%20whimsical%20scene%20featuring%20a%20traffic%20cop%20standing%20on%20a%20cloud,%20energetically%20directing%20a%20chaotic%20stream%20of%20various%20floating%20documents%20-%20papers,%20folder.png"><meta name=twitter:description content="Red Hat Advanced Cluster Management enables Open Cluster Management policy driven governance of an entire fleet of Kubernetes clusters. Associating policies with the appropriate clusters is a very …"><link rel=stylesheet type=text/css href=/css/asciinema-player.css><script src=/js/asciinema-player.js></script></head><body><div id=all><header class=navbar-affixed-top data-spy=affix data-offset-top=62><div class="navbar navbar-default yamm" role=navigation id=navbar><div class=container><div class=navbar-header><a class="navbar-brand home" href=/><img src=/img/logo.png alt="Using Placements to Apply Open Cluster Management Policies to Kubernetes Clusters logo" class="hidden-xs hidden-sm">
<img src=/img/logo-small.png alt="Using Placements to Apply Open Cluster Management Policies to Kubernetes Clusters logo" class="visible-xs visible-sm">
<span class=sr-only>Using Placements to Apply Open Cluster Management Policies to Kubernetes Clusters - go to homepage</span></a><div class=navbar-buttons><button type=button class="navbar-toggle btn-template-main" data-toggle=collapse data-target=#navigation>
<span class=sr-only>Toggle Navigation</span>
<i class="fas fa-align-justify"></i></button></div></div><div class="navbar-collapse collapse" id=navigation><ul class="nav navbar-nav navbar-right"><li class=dropdown><a href=/>Home</a></li><li class="dropdown active"><a href=/blog/>Blog</a></li><li class=dropdown><a href=/contact/>Contact</a></li></ul></div><div class="collapse clearfix" id=search><form class=navbar-form role=search><div class=input-group><input type=text class=form-control placeholder=Search>
<span class=input-group-btn><button type=submit class="btn btn-template-main"><i class="fas fa-search"></i></button></span></div></form></div></div></div></header><style>.bar.background-image-fixed-banner{background:url(/images/DALL%c2%b7E%202024-01-30%2014.28.24%20-%20A%20whimsical%20scene%20featuring%20a%20traffic%20cop%20standing%20on%20a%20cloud,%20energetically%20directing%20a%20chaotic%20stream%20of%20various%20floating%20documents%20-%20papers,%20folder.png)50% 0 no-repeat;background-attachment:fixed;background-size:cover;padding:100px 5%;text-shadow:2px 3px 4px var(--primary-accent),0 0 1em var(--navbar-border-top)}</style><div><div class=container><div class=row><div class=col-md-12><section class="bar background-image-fixed-banner heading h2 color-white text-center"><h1>Using Placements to Apply Open Cluster Management Policies to Kubernetes Clusters</h1></section></div></div></div></div><div id=content><div class=container><div class=row><div class=col-md-9 id=blog-post><p class="text-muted text-uppercase mb-small text-right">March 11, 2024</p><div id=post-content><p><a href=https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/ title=RHACM>Red Hat Advanced Cluster Management</a> (RHACM) enables Open Cluster Management policy driven governance of an entire fleet of Kubernetes clusters. Associating policies with the appropriate clusters is a very flexible operation and requires understanding resources like Placements and ManagedClusterSetBindings. So let&rsquo;s get familiar!</p><h1 id=open-cluster-management>Open Cluster Management</h1><p>Red Hat Advanced Cluster Management for Kubernetes implements the <a href=https://open-cluster-management.io/ title="Open Cluster Management">Open Cluster Management</a> APIs for the deployment (placement) of governance policies.</p><h2 id=policies>Policies</h2><p><code>Policy</code> resources are used to enact policies on a managed cluster. There is a large <a href=https://github.com/stolostron/policy-collection title="stolostron / policy-collection">collection of policies</a> that you can draw upon and customize for your particular use cases. This post focused only on the process of associating a policy with a cluster rather than what is in a given policy or how it is enacted.</p><blockquote><span class=expand><span class=expand-label style=cursor:pointer onclick='$h=$(this),$h.next("div").slideToggle(200,function(){$h.children("i").attr("class",function(){return $h.next("div").is(":visible")?"fas fa-chevron-down":"fas fa-chevron-right"})})'>📺 <strong>API Resources</strong> <code>policy.open-cluster-management.io</code>
<i class="fas fa-chevron-down"></i></span><div class=expand-content style="display:block;margin:10px 0"><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc api-resources --api-group policy.open-cluster-management.io
</span></span><span style=display:flex><span>NAME                    SHORTNAMES   APIVERSION                                  NAMESPACED   KIND
</span></span><span style=display:flex><span>certificatepolicies                  policy.open-cluster-management.io/v1        <span style=color:#658b00>true</span>         CertificatePolicy
</span></span><span style=display:flex><span>configurationpolicies                policy.open-cluster-management.io/v1        <span style=color:#658b00>true</span>         ConfigurationPolicy
</span></span><span style=display:flex><span>iampolicies                          policy.open-cluster-management.io/v1        <span style=color:#658b00>true</span>         IamPolicy
</span></span><span style=display:flex><span>placementbindings       pb           policy.open-cluster-management.io/v1        <span style=color:#658b00>true</span>         PlacementBinding
</span></span><span style=display:flex;background-color:#d6d6c6><span>policies                plc          policy.open-cluster-management.io/v1        <span style=color:#658b00>true</span>         Policy
</span></span><span style=display:flex><span>policyautomations       plca         policy.open-cluster-management.io/v1beta1   <span style=color:#658b00>true</span>         PolicyAutomation
</span></span><span style=display:flex><span>policysets              plcset       policy.open-cluster-management.io/v1beta1   <span style=color:#658b00>true</span>         PolicySet
</span></span></code></pre></div></div></span></blockquote><p>Policies are scoped to a namespace as you can see in the API resources table above. Policies can be associated to specific clusters in a fleet through a <code>Placement</code> or a <code>PlacementRule</code> resource.</p><h1 id=placement-rules>Placement Rules</h1><p>In the recent past resources called <code>PlacementRule</code> and <code>PlacementBindings</code> were used to associate a policy with a cluster. Those resources still exist but <code>PlacementRule</code> is now deprecated in favor of the <code>Placement</code> resource. This change enables greater control, and brings with it some other resources to facilitate the grouping of clusters into sets. These cluster sets enable more configurable RBAC.</p><blockquote><span class=expand><span class=expand-label style=cursor:pointer onclick='$h=$(this),$h.next("div").slideToggle(200,function(){$h.children("i").attr("class",function(){return $h.next("div").is(":visible")?"fas fa-chevron-down":"fas fa-chevron-right"})})'>📺 <strong>API Resources</strong> <code>apps.open-cluster-management.io</code>
<i class="fas fa-chevron-right"></i></span><div class=expand-content style="display:none;margin:10px 0"><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc api-resources --api-group apps.open-cluster-management.io
</span></span><span style=display:flex><span>NAME                                SHORTNAMES                   APIVERSION                                 NAMESPACED   KIND
</span></span><span style=display:flex><span>channels                                                         apps.open-cluster-management.io/v1         <span style=color:#658b00>true</span>         Channel
</span></span><span style=display:flex><span>deployables                                                      apps.open-cluster-management.io/v1         <span style=color:#658b00>true</span>         Deployable
</span></span><span style=display:flex><span>gitopsclusters                                                   apps.open-cluster-management.io/v1beta1    <span style=color:#658b00>true</span>         GitOpsCluster
</span></span><span style=display:flex><span>helmreleases                                                     apps.open-cluster-management.io/v1         <span style=color:#658b00>true</span>         HelmRelease
</span></span><span style=display:flex><span>multiclusterapplicationsetreports   appsetreport,appsetreports   apps.open-cluster-management.io/v1alpha1   <span style=color:#658b00>true</span>         MulticlusterApplicationSetReport
</span></span><span style=display:flex;background-color:#d6d6c6><span>placementrules                                                   apps.open-cluster-management.io/v1         <span style=color:#658b00>true</span>         PlacementRule
</span></span><span style=display:flex><span>subscriptionreports                 appsubreport                 apps.open-cluster-management.io/v1alpha1   <span style=color:#658b00>true</span>         SubscriptionReport
</span></span><span style=display:flex><span>subscriptions                       appsub                       apps.open-cluster-management.io/v1         <span style=color:#658b00>true</span>         Subscription
</span></span><span style=display:flex><span>subscriptionstatuses                appsubstatus                 apps.open-cluster-management.io/v1alpha1   <span style=color:#658b00>true</span>         SubscriptionStatus
</span></span></code></pre></div></div></span></blockquote><h1 id=managed-clusters-and-managed-cluster-sets>Managed Clusters and Managed Cluster Sets</h1><p>RHACM can manage OpenShift and other Kubernetes clusters. See my previous <a href=http://guifreelife.com/tags/RHACM/>posts on RHACM</a> for more background and recorded demonstrations.</p><p>Each Kubernetes cluster managed by RHACM is represented by a <code>ManagedCluster</code> resource. This resource is cluster scoped. You can see this in the table below.</p><blockquote><span class=expand><span class=expand-label style=cursor:pointer onclick='$h=$(this),$h.next("div").slideToggle(200,function(){$h.children("i").attr("class",function(){return $h.next("div").is(":visible")?"fas fa-chevron-down":"fas fa-chevron-right"})})'>📺 <strong>API Resources</strong> <code>cluster.open-cluster-management.io</code>
<i class="fas fa-chevron-right"></i></span><div class=expand-content style="display:none;margin:10px 0"><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc api-resources --api-group cluster.open-cluster-management.io
</span></span><span style=display:flex><span>NAME                        SHORTNAMES                     APIVERSION                                    NAMESPACED   KIND
</span></span><span style=display:flex><span>addonplacementscores                                       cluster.open-cluster-management.io/v1alpha1   <span style=color:#658b00>true</span>         AddOnPlacementScore
</span></span><span style=display:flex><span>backupschedules             bsch                           cluster.open-cluster-management.io/v1beta1    <span style=color:#658b00>true</span>         BackupSchedule
</span></span><span style=display:flex><span>clusterclaims                                              cluster.open-cluster-management.io/v1alpha1   <span style=color:#658b00>false</span>        ClusterClaim
</span></span><span style=display:flex><span>clustercurators                                            cluster.open-cluster-management.io/v1beta1    <span style=color:#658b00>true</span>         ClusterCurator
</span></span><span style=display:flex;background-color:#d6d6c6><span>managedclusters             mcl,mcls                       cluster.open-cluster-management.io/v1         <span style=color:#658b00>false</span>        ManagedCluster
</span></span><span style=display:flex><span>managedclustersetbindings   mclsetbinding,mclsetbindings   cluster.open-cluster-management.io/v1beta2    <span style=color:#658b00>true</span>         ManagedClusterSetBinding
</span></span><span style=display:flex><span>managedclustersets          mclset,mclsets                 cluster.open-cluster-management.io/v1beta2    <span style=color:#658b00>false</span>        ManagedClusterSet
</span></span><span style=display:flex><span>placementdecisions                                         cluster.open-cluster-management.io/v1beta1    <span style=color:#658b00>true</span>         PlacementDecision
</span></span><span style=display:flex><span>placements                                                 cluster.open-cluster-management.io/v1beta1    <span style=color:#658b00>true</span>         Placement
</span></span><span style=display:flex><span>restores                    crst                           cluster.open-cluster-management.io/v1beta1    <span style=color:#658b00>true</span>         Restore
</span></span></code></pre></div></div></span></blockquote><p>Multiple managed clusters may be grouped together into <code>ManagedClusterSets</code> for administrative and RBAC purposes. RHACM has two pre-defined cluster sets named <em>Global</em> and <em>Default</em>. All clusters will be in the Global set, and they can be added to at most only one other set. You might create a cluster set for lifecycle like <em>Dev</em> or cloud like <em>AWS</em> for example.</p><h2 id=managed-cluster-set-bindings>Managed Cluster Set Bindings</h2><p>A <code>ManagedClusterSetBinding</code> is a namespaced resource designed to create a relationship between a namespace and a <code>ManagedClusterSet</code>. This resource is prerequisite to a <code>Placement</code>. Without this, a placement has no clusters visible to match against.</p><p>The Global managed cluserset set is already bound to the <code>open-cluster-management-global-set</code> by default. You can see this in the console when listing the cluster sets.</p><figure><a href=/images/placement-managedclustersetbindings.png><img src=/images/placement-managedclustersetbindings.png alt="Cluster sets and Namespace bindings view" width=100%></a><figcaption><p>Cluster sets and Namespace bindings view</p></figcaption></figure><blockquote><span class=expand><span class=expand-label style=cursor:pointer onclick='$h=$(this),$h.next("div").slideToggle(200,function(){$h.children("i").attr("class",function(){return $h.next("div").is(":visible")?"fas fa-chevron-down":"fas fa-chevron-right"})})'>📺 <strong>ASCII Screencast</strong>
<i class="fas fa-chevron-right"></i></span><div class=expand-content style="display:none;margin:10px 0"><p>Viewing ManagedClusterSet resources</p><p><asciinema-player src=/casts/placement-mcsb-hub-lab-bewley-net-20240201_1044.cast cols=640 rows=25 loop=true start-at=0 speed=1 poster=npt:0:06 font-size=smaller></asciinema-player></p></div></span></blockquote><h1 id=placement>Placement</h1><p>A <code>Placement</code> exists to make a scheduling decision with regard to <code>Policies</code> and a selection of <code>ManagedClusters</code>. The result of a placement decision is a list of <code>ManagedClusters</code>.</p><p>The placement decision begins with a list of managed clusters visibile through the lense of a <code>ManagedClusterSetBinding</code> in the same namespace. Once the placement has this list it may optionally further winnow down that list through predicates like label selectors.</p><blockquote><p>📓 <strong>Important</strong></p><ul><li><code>Placement</code> label selectors only match clusters that are visible via a <code>ManagedClusterSetBinding</code></li><li>No clusters will be selected if no cluster set is bound to the namespace holding the placement resource</li></ul></blockquote><blockquote><p>⭐ <strong>Pro Tip</strong> Use <code>oc explain placement</code> to find the information I reformatted below.</p></blockquote><p><strong>Here is how the placement policy combines with other selection methods to determine a matching list of ManagedClusters:</strong></p><ol><li>Kubernetes clusters are registered with the RHACM hub as cluster-scoped <code>ManagedClusters</code></li><li><code>ManagedClusters</code> are organized into cluster-scoped <code>ManagedClusterSets</code></li><li><code>ManagedClusterSets</code> are bound to workload namespaces using <code>ManagedClusterSetBindings</code></li><li>Namespace-scoped <code>Placements</code> specify a <em>slice</em> of <code>ManagedClusterSets</code> which select a working set of <em>potential</em> <code>ManagedClusters</code></li><li>Then <code>Placements</code> <em>subselect</em> from that working set using label/claim selection.</li></ol><h2 id=subselecting-from-cluster-sets-with-predicates>Subselecting from Cluster Sets with Predicates</h2><p>A placement can explicitly list the ClusterSets of interest or it can simply list the cluster label selectors. BUT the universe of possible clusters is constrained to those bound to the namespace via the <a href=#managedclustersetbindings>managed cluster set bindings</a>.</p><p>Here are examples of both use cases. Of course they may also be combined into one.</p><blockquote><p>1️⃣ If a <code>Placement</code> specifies <code>spec.clusterSets[]</code> then it may specify a <code>spec.predicates.requiredClusterSelector{}</code> to filter the set of managed clusters.</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8b008b;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>cluster.open-cluster-management.io/v1beta1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>kind</span>:<span style=color:#bbb> </span>Placement<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>placement-1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>namespace</span>:<span style=color:#bbb> </span>ns1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>clusterSets</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- clusterset1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- clusterset2<span style=color:#bbb>
</span></span></span></code></pre></div><blockquote><p>2️⃣ If a <code>Placement</code> does not specify any <code>spec.clusterSets[]</code> it may still specify a <code>spec.predicates.requiredClusterSelector{}</code> which will only match against clusters found in sets bound to the current namespace (by a <code>ManagedClusterSetBinding</code>.)</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8b008b;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>cluster.open-cluster-management.io/v1beta1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>kind</span>:<span style=color:#bbb> </span>Placement<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>placement-2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>namespace</span>:<span style=color:#bbb> </span>ns1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>predicates</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:#8b008b;font-weight:700>requiredClusterSelector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>labelSelector</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#8b008b;font-weight:700>matchExpressions</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span>- {<span style=color:#8b008b;font-weight:700>key: environment, operator: In, values</span>:<span style=color:#bbb> </span>[<span style=color:#cd5555>&#34;dev&#34;</span>]}<span style=color:#bbb>
</span></span></span></code></pre></div><p>When more than one predicate is defined, they are OR&rsquo;ed. Refer to the <a href=https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.9/html/clusters/cluster_mce_overview#placement-labelselector-claimSelector title="Filtering ManagedClusters from ManagedClusterSets">documentation</a> for more detail.</p><h1 id=placement-binding>Placement Binding</h1><p>Once a placement produces a list of managed clusters the policy resource must be associated with and ultimately propagated to the clusters. This is the job of the <code>PlacementBinding</code>.</p><blockquote><p>📓 A <code>PlacementBinding</code> binds a <code>Placement</code> to subjects (eg. <code>Policies</code>, <code>PolicySets</code>)</p></blockquote><p>This example is pulled from a <a href=https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.9/html/governance/governance#policy-sample-file title="Policy Sample File">documentation sample</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8b008b;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>policy.open-cluster-management.io/v1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>kind</span>:<span style=color:#bbb> </span>PlacementBinding<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>binding-policy-role<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>placementRef</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>placement-policy-role<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>kind</span>:<span style=color:#bbb> </span>Placement<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>cluster.open-cluster-management.io<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>subjects</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>policy-role<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>kind</span>:<span style=color:#bbb> </span>Policy<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>apiGroup</span>:<span style=color:#bbb> </span>policy.open-cluster-management.io<span style=color:#bbb>
</span></span></span></code></pre></div><h1 id=fitting-it-all-together>Fitting it all together</h1><p>In this visual representation there are 3 corporate standard policies which we expect to apply to all 4 of our clusters, and there is 1 additional policy which we expect to apply to the production clusters.</p><p>This is accomplished by creating a standard (&ldquo;STD&rdquo;) Placement that targets all clusters and a PROD Placement that matches only the production cluster. This targetting is permitted by the existance of the ManagedClusterSetBinding in this same namespace.</p><div class=mermaid>graph TD;
subgraph clusterwide["Cluster Scoped Resources"]
subgraph mcs-dev["ManagedClusterSet 'Dev'"]
cluster-dev1["Cluster Dev-1"]
cluster-dev2["Cluster Dev-2"]
end
subgraph mcs-prod["ManagedClusterSet 'Prod'"]
cluster-prod1["Cluster Prod-1"]
cluster-prod2["Cluster Prod-2"]
end
end
subgraph ns-my-policies["Namespace 'my-policies'"]
mcsb-dev("fa:fa-file-contract ManagedClusterSetBinding 'dev'")
mcsb-dev -.-> mcs-dev
mcsb-prod("fa:fa-file-contract ManagedClusterSetBinding 'prod'")
mcsb-prod -.-> mcs-prod
policy-std-1["fa:fa-file-code Policy 'corp-std-1'"]
policy-std-2["fa:fa-file-code Policy 'corp-std-2'"]
policy-std-3["fa:fa-file-code Policy 'corp-std-3'"]
policy-prod["fa:fa-file-code Policy 'prod-config'"]
placement-std["fa:fa-filter Placement 'std'"]
placement-prod["fa:fa-filter Placement 'prod'"]
placementbinding-std("fa:fa-file-contract PlacementBinding 'std'")
placementbinding-prod("fa:fa-file-contract PlacementBinding 'prod'")
policy-std-1 --> placementbinding-std
policy-std-2 --> placementbinding-std
policy-std-3 --> placementbinding-std
placementbinding-std --> placement-std
placement-std --> mcsb-dev
placement-std --> mcsb-prod
policy-prod --> placementbinding-prod --> placement-prod
placement-prod --> mcsb-prod
placement-std-filter{"fa:fa-filter Optional filter on<br>cluster set by labels"}
end</div><h1 id=summary>Summary</h1><p><code>ManagedClusterSetBindings</code> provide a controlled lense through which ManagedClusterSets may be managed. By controlling the creation of ManagedClusterSetBindings, the Policy management task may be delegated to a namespace administrator while retaining the control over which clusters may be impacted by that namespace administrator.</p><h1 id=references>References</h1><ul><li><a href=https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/ title=RHACM>Red Hat Advanced Cluster Management for Kubernetes</a></li><li><a href=https://access.redhat.com/documentation/en-us/red_hat_advanced_cluster_management_for_kubernetes/2.9/html/clusters/cluster_mce_overview#placement-intro title="Placement Introduction">Placement Introduction</a></li><li><a href=https://github.com/stolostron/policy-collection title="stolostron / policy-collection">Collection of policy examples for Open Cluster Management</a></li><li><a href=https://open-cluster-management.io/ title="Open Cluster Management">Open Cluster Management</a></li></ul></div><script type=application/javascript src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>var config={startOnLoad:!0,theme:"base",align:"center"};mermaid.initialize(config)</script><div id=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//dlbewleygithubio.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class=col-md-3><div class="panel panel-default sidebar-menu"><div class=panel-heading><h3 class=panel-title>Search</h3></div><div class=panel-body><form action=//google.com/search method=get accept-charset=utf-8 role=search><div class=input-group><input type=search name=q class=form-control placeholder=Search>
<input type=hidden name=sitesearch value=http://guifreelife.com/>
<span class=input-group-btn><button type=submit class="btn btn-template-main"><i class="fas fa-search"></i></button></span></div></form></div></div><div class="panel sidebar-menu"><div class=panel-heading><h3 class=panel-title>Tagged</h3></div><div class=panel-body><ul class=tag-cloud><li class=active><a href=/tags/RHACM><i class="fas fa-tags"></i> RHACM</a></li><li class=active><a href=/tags/openshift><i class="fas fa-tags"></i> openshift</a></li><li class=active><a href=/tags/kubernetes><i class="fas fa-tags"></i> kubernetes</a></li></ul></div></div><div class="panel sidebar-menu"><div class=panel-heading><h3 class=panel-title>TOC</h3></div><div class=panel-body><nav id=TableOfContents><ul><li><a href=#open-cluster-management>Open Cluster Management</a><ul><li><a href=#policies>Policies</a></li></ul></li><li><a href=#placement-rules>Placement Rules</a></li><li><a href=#managed-clusters-and-managed-cluster-sets>Managed Clusters and Managed Cluster Sets</a><ul><li><a href=#managed-cluster-set-bindings>Managed Cluster Set Bindings</a></li></ul></li><li><a href=#placement>Placement</a><ul><li><a href=#subselecting-from-cluster-sets-with-predicates>Subselecting from Cluster Sets with Predicates</a></li></ul></li><li><a href=#placement-binding>Placement Binding</a></li><li><a href=#fitting-it-all-together>Fitting it all together</a></li><li><a href=#summary>Summary</a></li><li><a href=#references>References</a></li></ul></nav></div></div><div class="panel sidebar-menu"><div class=panel-heading><h3 class=panel-title>Tags</h3></div><div class=panel-body><ul class=tag-cloud><li><a href=/tags/AWS><i class="fas fa-tags"></i> AWS</a></li><li><a href=/tags/CDK><i class="fas fa-tags"></i> CDK</a></li><li><a href=/tags/OCP3><i class="fas fa-tags"></i> OCP3</a></li><li><a href=/tags/OCP4><i class="fas fa-tags"></i> OCP4</a></li><li><a href=/tags/RHACM><i class="fas fa-tags"></i> RHACM</a></li><li><a href=/tags/RHACS><i class="fas fa-tags"></i> RHACS</a></li><li><a href=/tags/RHEL><i class="fas fa-tags"></i> RHEL</a></li><li><a href=/tags/ansible><i class="fas fa-tags"></i> ansible</a></li><li><a href=/tags/automation><i class="fas fa-tags"></i> automation</a></li><li><a href=/tags/azure><i class="fas fa-tags"></i> azure</a></li><li><a href=/tags/debugging><i class="fas fa-tags"></i> debugging</a></li><li><a href=/tags/docker><i class="fas fa-tags"></i> docker</a></li><li><a href=/tags/draft><i class="fas fa-tags"></i> draft</a></li><li><a href=/tags/etcd><i class="fas fa-tags"></i> etcd</a></li><li><a href=/tags/git><i class="fas fa-tags"></i> git</a></li><li><a href=/tags/haproxy><i class="fas fa-tags"></i> haproxy</a></li><li><a href=/tags/heat><i class="fas fa-tags"></i> heat</a></li><li><a href=/tags/hybrid-cloud><i class="fas fa-tags"></i> hybrid-cloud</a></li><li><a href=/tags/install><i class="fas fa-tags"></i> install</a></li><li><a href=/tags/kubernetes><i class="fas fa-tags"></i> kubernetes</a></li><li><a href=/tags/mac><i class="fas fa-tags"></i> mac</a></li><li><a href=/tags/metrics><i class="fas fa-tags"></i> metrics</a></li><li><a href=/tags/migration><i class="fas fa-tags"></i> migration</a></li><li><a href=/tags/monitoring><i class="fas fa-tags"></i> monitoring</a></li><li><a href=/tags/networking><i class="fas fa-tags"></i> networking</a></li><li><a href=/tags/openshift><i class="fas fa-tags"></i> openshift</a></li><li><a href=/tags/openstack><i class="fas fa-tags"></i> openstack</a></li><li><a href=/tags/operators><i class="fas fa-tags"></i> operators</a></li><li><a href=/tags/prometheus><i class="fas fa-tags"></i> prometheus</a></li><li><a href=/tags/python><i class="fas fa-tags"></i> python</a></li><li><a href=/tags/router><i class="fas fa-tags"></i> router</a></li><li><a href=/tags/security><i class="fas fa-tags"></i> security</a></li><li><a href=/tags/ssl><i class="fas fa-tags"></i> ssl</a></li><li><a href=/tags/stackrox><i class="fas fa-tags"></i> stackrox</a></li><li><a href=/tags/storage><i class="fas fa-tags"></i> storage</a></li><li><a href=/tags/troubleshooting><i class="fas fa-tags"></i> troubleshooting</a></li><li><a href=/tags/upgrade><i class="fas fa-tags"></i> upgrade</a></li><li><a href=/tags/vagrant><i class="fas fa-tags"></i> vagrant</a></li><li><a href=/tags/virtualization><i class="fas fa-tags"></i> virtualization</a></li><li><a href=/tags/webinar><i class="fas fa-tags"></i> webinar</a></li><li><a href=/tags/windows><i class="fas fa-tags"></i> windows</a></li><li><a href=/tags/zabbix><i class="fas fa-tags"></i> zabbix</a></li><li><a href=/tags/zimbra><i class="fas fa-tags"></i> zimbra</a></li></ul></div></div></div></div></div></div><footer id=footer><div class=container><div class="col-md-4 col-sm-6"><h4>Share</h4><i class="fab fa-2x fa-twitter" title="Share this on Twitter" onclick='window.open("http://twitter.com/home?status=http://guifreelife.com/blog/2024/03/11/Placing-Open-Cluster-Management-Policies-on-Kubernetes/")'></i>
<i class="fab fa-2x fa-facebook" title="Share this on Facebook" onclick='window.open("http://www.facebook.com/share.php?u=http://guifreelife.com/blog/2024/03/11/Placing-Open-Cluster-Management-Policies-on-Kubernetes/")'></i>
<i class="fab fa-2x fa-linkedin" title="Share this on Linkedin" onclick='window.open("https://www.linkedin.com/shareArticle?mini=true&url=http://guifreelife.com/blog/2024/03/11/Placing-Open-Cluster-Management-Policies-on-Kubernetes/&title=&summary=&source=")'></i>
<i class="fab fa-2x fa-google-plus" title="Share this on Google Currents" onclick='window.open("https://plus.google.com/share?url=http://guifreelife.com/blog/2024/03/11/Placing-Open-Cluster-Management-Policies-on-Kubernetes/")'></i>
<i class="fa fa-2x fa-envelope" title="Share this through Email" onclick='window.open("mailto:?&body=http://guifreelife.com/blog/2024/03/11/Placing-Open-Cluster-Management-Policies-on-Kubernetes/")'></i><h4>About us</h4><p>GUI Free Life is the personal, technical blog of Dale Bewley. Comments and opinions are my own and not that of my employers.</p><hr class="hidden-md hidden-lg hidden-sm"></div><div class="col-md-4 col-sm-6"><h4>Recent posts</h4><div class=blog-entries><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=http://guifreelife.com/blog/2024/11/19/Open-Virtual-Network-Inspection-on-OpenShift/><img src=/images/cat-loves-ovn.png class=img-responsive alt="Open Virtual Networking Inspection with OpenShift"></a></div><div class="name same-height-always"><h5><a href=http://guifreelife.com/blog/2024/11/19/Open-Virtual-Network-Inspection-on-OpenShift/>Open Virtual Networking Inspection with OpenShift</a></h5></div></div><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=http://guifreelife.com/blog/2024/03/11/Placing-Open-Cluster-Management-Policies-on-Kubernetes/><img src=/images/DALL%c2%b7E%202024-01-30%2014.28.24%20-%20A%20whimsical%20scene%20featuring%20a%20traffic%20cop%20standing%20on%20a%20cloud,%20energetically%20directing%20a%20chaotic%20stream%20of%20various%20floating%20documents%20-%20papers,%20folder.png class=img-responsive alt="Using Placements to Apply Open Cluster Management Policies to Kubernetes Clusters"></a></div><div class="name same-height-always"><h5><a href=http://guifreelife.com/blog/2024/03/11/Placing-Open-Cluster-Management-Policies-on-Kubernetes/>Using Placements to Apply Open Cluster Management Policies to Kubernetes Clusters</a></h5></div></div><div class="item same-height-row clearfix"><div class="image same-height-always"><a href=http://guifreelife.com/blog/2023/09/22/Storing-OpenShift-Credentials-with-1Password/><img src=/img/banners/mushroom-moss.jpg class=img-responsive alt="Storing OpenShift Credentials with 1Password"></a></div><div class="name same-height-always"><h5><a href=http://guifreelife.com/blog/2023/09/22/Storing-OpenShift-Credentials-with-1Password/>Storing OpenShift Credentials with 1Password</a></h5></div></div></div><hr class="hidden-md hidden-lg"></div><div class="col-md-4 col-sm-6"><h4>Contact</h4><p class=text-uppercase><strong>Dale Bewley</strong><br>Oakland<br>California<br><strong>USA</strong></p><a href=/contact class="btn btn-small btn-template-main">Go to contact page</a><hr class="hidden-md hidden-lg hidden-sm"></div></div></footer><div id=copyright><div class=container><div class=col-md-12><p class=pull-left>Copyright (c) 2021, Dale Bewley; all rights reserved.</p><p class=pull-right>Template by <a href=https://bootstrapious.com/p/universal-business-e-commerce-template>Bootstrapious</a>.
Ported to Hugo by <a href=https://github.com/devcows/hugo-universal-theme>DevCows</a>.</p></div></div></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-39TSW9349X"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-39TSW9349X",{anonymize_ip:!1})}</script><script src=//code.jquery.com/jquery-3.1.1.min.js integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin=anonymous></script>
<script src=//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js></script>
<script src="//maps.googleapis.com/maps/api/js?key=AIzaSyDacpwSIXi6lk2fS2wzZOSoh7iHm_ZP3UE&v=3.exp"></script>
<script src=/js/hpneo.gmaps.js></script>
<script src=/js/gmaps.init.js></script>
<script src=/js/front.js></script>
<script src=/js/owl.carousel.min.js></script></body></html>