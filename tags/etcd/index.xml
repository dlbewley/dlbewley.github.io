<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Etcd on GUI Free Life</title><link>http://guifreelife.com/tags/etcd/</link><description>Recent content in Etcd on GUI Free Life</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Tue, 19 Feb 2019 00:00:00 +0000</lastBuildDate><atom:link href="http://guifreelife.com/tags/etcd/index.xml" rel="self" type="application/rss+xml"/><item><title>Downgrade Etcd 3.3.11 to 3.2.22 for OpenShift Compatibility</title><link>http://guifreelife.com/blog/2019/02/19/Downgrade-Etcd-for-OpenShift-Compatibility/</link><pubDate>Tue, 19 Feb 2019 00:00:00 +0000</pubDate><guid>http://guifreelife.com/blog/2019/02/19/Downgrade-Etcd-for-OpenShift-Compatibility/</guid><description>&lt;p>While I was working on &lt;a href="http://guifreelife.com/blog/2019/02/08/Migration-of-Etcd-to-Masters-for-OpenShift-3.9-Upgrade-to-3.10">migrating etcd to my master nodes&lt;/a> I was bitten by an incompatible etcd v3.3.11 RPM made available via RHEL Server Extras repo. Before I got to my last master the RPM was no longer available, and the scaleup playbook failed. I became aware that 3.3.11 &lt;a href="https://access.redhat.com/articles/2176281">is not compatible&lt;/a> and &lt;a href="https://access.redhat.com/solutions/3885101">should not have been made available&lt;/a>.&lt;/p>
&lt;p>Unfortunately all members of my etcd cluster were already upgraded and the fix is to take down the cluster, downgrade etcd, and restore from snapshot. It would be great &lt;a href="https://bugzilla.redhat.com/show_bug.cgi?id=1672518">if the etcd version was pinned&lt;/a> like Docker is.&lt;/p></description></item><item><title>Etcdctl v2 and v3 Aliases for Peer Authenticated Commands</title><link>http://guifreelife.com/blog/2019/02/08/Etcd-Shortcut-With-Peer-Auth/</link><pubDate>Fri, 08 Feb 2019 00:00:00 +0000</pubDate><guid>http://guifreelife.com/blog/2019/02/08/Etcd-Shortcut-With-Peer-Auth/</guid><description>&lt;p>Getting all the arguments to &lt;code>etcdctl&lt;/code> right can be a bit of a pain. Here are a couple of aliases which take advantage of the values in the &lt;code>etcd.conf&lt;/code> file.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#658b00">alias&lt;/span> &lt;span style="color:#00688b">etcd2&lt;/span>=&lt;span style="color:#cd5555">&amp;#39;. /etc/etcd/etcd.conf &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cd5555"> ETCDCTL_API=2 etcdctl \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cd5555"> --cert-file ${ETCD_PEER_CERT_FILE} \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cd5555"> --key-file ${ETCD_PEER_KEY_FILE} \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cd5555"> --ca-file ${ETCD_PEER_TRUSTED_CA_FILE:-$ETCD_PEER_CA_FILE} \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cd5555"> --endpoints &amp;#34;${ETCD_ADVERTISE_CLIENT_URLS}&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#658b00">alias&lt;/span> &lt;span style="color:#00688b">etcd3&lt;/span>=&lt;span style="color:#cd5555">&amp;#39;. /etc/etcd/etcd.conf &amp;amp;&amp;amp; \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cd5555"> ETCDCTL_API=3 etcdctl \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cd5555"> --cert ${ETCD_PEER_CERT_FILE} \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cd5555"> --key ${ETCD_PEER_KEY_FILE} \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cd5555"> --cacert ${ETCD_PEER_TRUSTED_CA_FILE:-$ETCD_PEER_CA_FILE} \
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#cd5555"> --endpoints &amp;#34;${ETCD_ADVERTISE_CLIENT_URLS}&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you are using OpenShift, you may also find that you already have some bash functions &lt;a href="https://github.com/openshift/openshift-ansible/blob/master/roles/etcd/tasks/drop_etcdctl.yml">enabled by the etcd role&lt;/a> in &lt;code>/etc/profile.d/etcdctl.sh&lt;/code>. They will look different depending on your version. Below is from 3.9.&lt;/p></description></item><item><title>Migration of Etcd to Masters for OpenShift 3.9 to 3.10 Upgrade</title><link>http://guifreelife.com/blog/2019/02/08/Migration-of-Etcd-to-Masters-for-OpenShift-3.9-Upgrade-to-3.10/</link><pubDate>Fri, 08 Feb 2019 00:00:00 +0000</pubDate><guid>http://guifreelife.com/blog/2019/02/08/Migration-of-Etcd-to-Masters-for-OpenShift-3.9-Upgrade-to-3.10/</guid><description>&lt;p>As of OpenShift Container Platform 3.10 etcd is expected to run in &lt;a href="https://docs.openshift.com/container-platform/3.10/release_notes/ocp_3_10_release_notes.html#ocp-310-control-plane-changes">static pods&lt;/a> on the master nodes in the control plane. You may have a deployed an HA cluster with dedicated etcd nodes managed with systemd. How do you migrate the this new architecture?&lt;/p>
&lt;p>&lt;strong>Assumptions:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>You are running OCP 3.9&lt;/li>
&lt;li>You have multiple Master nodes&lt;/li>
&lt;li>You have dedicated Etcd nodes&lt;/li>
&lt;li>You are running RHEL, not Atomic nodes&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>Outline:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Backup etcd&lt;/li>
&lt;li>Scale up Etcd cluster to include Master nodes&lt;/li>
&lt;li>Configure Openshift Masters to ignore the old Etcd nodes&lt;/li>
&lt;li>Scale down etcd cluster to remove old Etcd nodes&lt;/li>
&lt;/ul>
&lt;h1 id="detailed-steps">Detailed Steps&lt;/h1>
&lt;p>Follow along in this document &lt;a href="https://docs.openshift.com/container-platform/3.9/admin_guide/assembly_replace-etcd-member.html">https://docs.openshift.com/container-platform/3.9/admin_guide/assembly_replace-etcd-member.html&lt;/a>
You may find &lt;a href="http://guifreelife.com/blog/2019/02/08/Etcd-Shortcut-With-Peer-Auth">some etcd aliases handy&lt;/a> before proceeding.&lt;/p></description></item></channel></rss>